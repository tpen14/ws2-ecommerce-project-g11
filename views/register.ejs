<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="register-page">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="/" class="navbar-brand">
            <img src="/images/chonccolate.png" alt="Chonccolate" class="navbar-logo">
            Chonccolate
        </a>
        
        <button class="menu-toggle" id="menuToggle">â˜°</button>
        
        <ul class="navbar-links" id="navbarLinks">
            <li><a href="/">Home</a></li>
            <li><a href="/products">Products</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
        </ul>
        
        <div class="auth-buttons" id="authButtons">
            <a href="/users/login" class="auth-button login">Login</a>
            <a href="/users/register" class="auth-button register active">Register</a>
        </div>
    </nav>

    <div class="register-container">
        <form action="/users/register" method="POST" id="registrationForm" class="form-card">
            <h2>Create Account</h2>
            <p class="form-subtitle">Join our community today</p>
            
            <% if (typeof error !== 'undefined' && error) { %>
                <div class="alert alert-danger">
                    <%= error %>
                </div>
            <% } %>

            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" name="firstName" value="<%= typeof firstName !== 'undefined' ? firstName : '' %>" required>
                </div>
                
                <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" name="lastName" value="<%= typeof lastName !== 'undefined' ? lastName : '' %>" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" value="<%= typeof email !== 'undefined' ? email : '' %>" required>
            </div>
            
            <div class="form-group password-field">
                <label for="password">Password</label>
                <div class="password-input-wrapper">
                    <input type="password" id="password" name="password" required>
                    <button type="button" class="toggle-password" data-target="password">Show</button>
                </div>
                
                <div class="password-criteria">
                    <div class="criteria-item" id="length">At least 8 characters</div>
                    <div class="criteria-item" id="uppercase">Includes uppercase letter</div>
                    <div class="criteria-item" id="lowercase">Includes lowercase letter</div>
                    <div class="criteria-item" id="number">Includes at least one number</div>
                    <div class="criteria-item" id="special">Includes at least one special character</div>
                </div>
            </div>
            
            <div class="form-group password-field">
                <label for="confirmPassword">Confirm Password</label>
                <div class="password-input-wrapper">
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                    <button type="button" class="toggle-password" data-target="confirmPassword">Show</button>
                </div>
                <div class="password-match-message" id="passwordMatch"></div>
            </div> 
            <!-- Turnstile widget -->
            <div class="cf-turnstile" data-sitekey="<%= process.env.TURNSTILE_SITEKEY %>"></div>
            <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
           
            <div class="form-actions">
                <button type="submit" id="submitBtn" class="primary-button">Register</button>
            </div>
            
            <div class="form-links">
                <p>Already have an account? <a href="/users/login">Login here</a></p>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const form = document.getElementById('registrationForm');
            const toggleButtons = document.querySelectorAll('.toggle-password');
            const submitBtn = document.getElementById('submitBtn');
            
            // Menu toggle
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('navbarLinks').classList.toggle('active');
                document.getElementById('authButtons').classList.toggle('active');
            });
            
            // Password visibility toggle
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const inputField = document.getElementById(targetId);
                    
                    if (inputField.type === 'password') {
                        inputField.type = 'text';
                        this.textContent = 'Hide';
                    } else {
                        inputField.type = 'password';
                        this.textContent = 'Show';
                    }
                });
            });
            
            // Password validation criteria
            const criteria = {
                length: { regex: /.{8,}/, element: document.getElementById('length') },
                uppercase: { regex: /[A-Z]/, element: document.getElementById('uppercase') },
                lowercase: { regex: /[a-z]/, element: document.getElementById('lowercase') },
                number: { regex: /[0-9]/, element: document.getElementById('number') },
                special: { regex: /[!@#$%^&*(),.?":{}|<>]/, element: document.getElementById('special') }
            };
            
            // Password validation
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let isValid = true;
                
                // Check each criteria
                for (const key in criteria) {
                    const isMatch = criteria[key].regex.test(password);
                    if (isMatch) {
                        criteria[key].element.classList.add('valid');
                    } else {
                        criteria[key].element.classList.remove('valid');
                        isValid = false;
                    }
                }
                
                // Check if passwords match
                if (confirmPasswordInput.value) {
                    validatePasswordMatch();
                }
                
                // Enable or disable submit button
                updateSubmitButton();
            });
            
            // Password match validation
            function validatePasswordMatch() {
                const passwordMatch = document.getElementById('passwordMatch');
                if (passwordInput.value === confirmPasswordInput.value) {
                    passwordMatch.textContent = 'Passwords match';
                    passwordMatch.style.color = '#155724';
                    return true;
                } else {
                    passwordMatch.textContent = 'Passwords do not match';
                    passwordMatch.style.color = '#721c24';
                    return false;
                }
            }
            
            confirmPasswordInput.addEventListener('input', function() {
                validatePasswordMatch();
                updateSubmitButton();
            });
            
            // Update submit button state
            function updateSubmitButton() {
                // Check password criteria
                let passwordIsValid = true;
                for (const key in criteria) {
                    if (!criteria[key].regex.test(passwordInput.value)) {
                        passwordIsValid = false;
                        break;
                    }
                }
                
                // Check password match
                const passwordsMatch = passwordInput.value === confirmPasswordInput.value;
                
                // Enable/disable button
                submitBtn.disabled = !(passwordIsValid && passwordsMatch);
            }
            
            // Form submission validation
            form.addEventListener('submit', function(e) {
                // Check password strength
                let passwordIsValid = true;
                for (const key in criteria) {
                    if (!criteria[key].regex.test(passwordInput.value)) {
                        passwordIsValid = false;
                        break;
                    }
                }
                
                // Check password match
                const passwordsMatch = passwordInput.value === confirmPasswordInput.value;
                
                if (!passwordIsValid || !passwordsMatch) {
                    e.preventDefault();
                    alert('Please ensure your password meets all criteria and both passwords match.');
                }
            });
        });
    </script>
</body>
</html>